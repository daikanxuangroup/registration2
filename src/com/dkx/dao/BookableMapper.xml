<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper SYSTEM "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- 命名空间对应映射器接口 -->
<mapper namespace="com.dkx.dao.BookableMapper">

	<resultMap type="com.dkx.pojo.WeekBean" id="week-result">
  	<id property="doid" column="doid"/>
  	<id property="time" column="time"/>
  	<result property="doname" column="doname"/>
  	<result property="reg1" column="reg1"/>
  	<result property="reg2" column="reg2"/>
  	<result property="reg3" column="reg3"/>
  	<result property="reg4" column="reg4"/>
  	<result property="reg5" column="reg5"/>
  	<result property="reg6" column="reg6"/>
  	<result property="reg7" column="reg7"/>
  </resultMap>
  
  <select id="findBK" resultMap="week-result">
  	select distinct  do.doid,do.doname,'上午' time,
       <foreach collection="bklist" separator="," item="item" index="index">
       	(select decode(count(*) ,0,'','可预约') from BOOKABLE where doid = do.doid and starttime = -1 and bdate=to_date(#{item},'yyyy-MM-dd')) reg${index+1} 
       </foreach>
 	from doctors do left join  bookable b on b.doid = do.doid  where do.deid = #{deid}  and do.doexist =1 
 	union all 
 	select distinct  do.doid,do.doname,'下午' time,
       <foreach collection="bklist" separator="," item="item" index="index">
       	(select decode(count(*) ,0,'','可预约') from BOOKABLE where doid = do.doid and starttime = 1 and bdate=to_date(#{item},'yyyy-MM-dd')) reg${index+1}
       </foreach>
 	from doctors do left join  bookable b on b.doid = do.doid  where do.deid =  #{deid}  and do.doexist =1  
 	group by do.doid,do.doname,b.starttime order by time
  </select>
  
  
</mapper>